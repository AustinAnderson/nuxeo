Nuxeo Runtime

## Goals and objectives

We want to improve the developer experience when using Nuxeo Platform.
This implies improving the infrastructure of the Platform : Nuxeo Runtime and associated tools.

There are several aspects we want to address :

 - Make the system more deterministic and easier to debug
     - fix bad hot reload
     - make the runtime break explicitly in case of bad configuration
 - Make the development cycle easier and faster
     - provide efficient hot reload
     - make the test framework more consistent
     - speed up testing
     - provide an embedded server
 - Make Nuxeo more standard to deploy
     - use the WAR model as default production deployment model

## The global picture :

### Development vs Production

Our platform is very dynamic and modular, but in a sense we are either too dynamic or not enough depending on the point of view.

 - when running in provisioning mode we would like to be even more dynamic
 - when running in production mode we don't want all the dynamic features at all

This means we at the same time to :

 - improve the dynamic deployment for development
 - improve the static WAR deployment for production

### Development mode and embedded servlet container

Currently the Nuxeo Server is an hybrid between NuxeoCtl, Tomcat and Nuxeo Runtime. Using tomcat in development mode does not
really help, we just loose some control : NuxeoCtl starts Tomcat, but it is Tomcat that starts Nuxeo Runtime.

For the development mode, we will align on the way it works in test mode. Nuxeo Runtime starts as a standalone application 
with it's own class loading system. It will run the web fragments inside it's own embedded servlet container (being it Tomcat
 or not). Having a better control over the servlet container can allow us to better manage the web fragments loading and 
open the way for better hot reload.

### Production mode and Packaging webapp

In production mode, we can simply use a WAR that was generated from the packaging application.

However, we still need :

 - to be able to install hotfixes
 - to be able to generate the production WARs from CI

The underlying logic is what is currently available inside NuxeoCtl :

 - Connect Client + Marketplace installation
 - WAR assembly

This logic should be available :

 - as a command line (like today)
 - as a WebApp

This *"Packaging WebApp"* will be usable to install HotFixes and MP.

This means that for the clients that don't have a full continuous delivery system where Hotfixed WARs are generated by CI, 
they can use a live server that technically hosts 2 WARs :

 - one packaging WAR
 - one production WAR

## Design

## Technical tasks

### Tighten Nuxeo Runtime

[NXP-16490](https://jira.nuxeo.com/browse/NXP-16490)

Expected workload : small
Expected gain : huge for beginners

### Nuxeo Runtime with Isolated ClassLoader

Currently the hot reload model is a kind of hack : for complex cases, registries have to be specifically designed. By improving the Nuxeo Runtime and including class loading isolation we can :

  - track dependencies between bundles based on the class loading and the component requirements
  - restart the components in the right order with fresh registries from new class loaders

Expected workload : large ?
Expected gain : significant, especially for developers

### Test Framework

The goal is to finish the alignment work on the Test Framework.

XXX Tasks ???

Expected workload : medium
Expected gain : significant, especially for developers

### Multi-Threaded tests

The goal is to be able to run the tests in Multi-Threaded mode to reduce the testing time.

XXX Tasks ???

Expected workload : medium / large ? (to have 100% of the tests)
Expected gain : no really sure, but I would like to be proven wrong

### Extract NuxeoCtl packaging logic into a WebApp

When running in "static mode", the UpdateCenter screen as well as the configuration screen is not usable.

We need to have a dedicated configuration WAR that wraps NuxeoCtl features :

 - provide a simple UI for managing Markerplace Packages
 - rebuilds the WAR
 - replace the Nuxeo WAR

To some extend, this could be similar to the Nuxeo wizard WebApp or to the Tomcat manager WebApp.
